---
- name: Remove tools that are no longer used
  pacman:
    state: absent
    extra_args: "--recursive"
    name:
      - okular
      - emojione-color-font
      - lib32-apulse
      - ltrace
      - skype
      - ndenv
      - node-build
      - pkgfile
      - openvpn-update-resolv-conf  # now managed by ansible directly
      - cython
      - youtube-dl  # done through pyenv
      - frogr
      - urlscan
      - xorg-xgamma
      - laptop-mode
      - docker
      - netatop-dkms
      - netatop
      - gvfs-mtp
      - mtpfs
      - mcelog  # not in community or aur any more
      - jfsutils
      - nano
      - pcmciautils
      - reiserfsprogs
      - s-nail
      - evince
      - acpi
      - vlock-original
      - screenkey
      - xprintidle
      - prompter
      - gnome-icon-theme
      - arch-install-scripts
      - autossh
      - pinta
      - lshw
      - gthumb
      - libreoffice-fresh
      - xautolock
      - xbanish
      - logrotate
      - wireshark-cli
      - nmap
      - tcpdump
      - nethogs
      - alsa-utils
      - notmuch
      - notmuch-mutt
      - isync
      - openvpn
      - ntp
      - firefox-unbranded-bin
      - firefox
      - chromium
      - certbot
      - thermald
      - pacaur
      - cower
      - bluejeans
      - pkgbuild-introspection
      - slock
      - throttled
      - tor-browser-en
      - kid3
      - dhclient
      - flashplugin
      - dmidecode
      - id3v2
      - clang
      - antiword
      - xdotool
      - tigervnc
      - cern-vdt
      - timeshift
      - aria2
      - mercurial
      - ngrep
      - mtr
      - netbrake
      - phonon-qt5
      - phonon-qt5-gstreamer
      - smartmontools


- name: Remove unused files
  file: path={{ item }} state=absent
  with_items:
    - /etc/udev/rules.d/99-deadline-for-ssd.rules
    - /etc/cron.d/clear-corrupt-journals
    - /etc/modprobe.d/99-i915.conf
    - /etc/systemd/system/localepurge.service
    - /etc/systemd/system/localepurge.timer
    - /usr/local/bin/powertargets
    - /usr/local/bin/powerdown
    - /usr/local/bin/powerup
    - /etc/systemd/system/powerdown.service
    - /etc/systemd/system/powerup.service
    - /etc/acpi/events/ansible
    - /etc/X11/xorg.conf.d/99-xorg-intel-tearing.conf
    - /etc/modules-load.d/no-wifi-power-save.conf
    - /etc/sysctl.d/99-laptop.conf
    - /etc/sysctl.d/99-dirty.conf
    - /etc/sysctl.d/99-sysrq.conf
    - /etc/sysctl.d/99-trace.conf
    - /etc/lenovo_fix.conf

- name: Remove old crons (now timers)
  file: path={{ item }} state=absent
  with_items:
    - /etc/cron.d/download-updates
    - /etc/cron.d/clean-cache
    - /etc/cron.d/fstrim
    - /etc/cron.d/i8kfan
    - /etc/cron.d/pkgfile
    - /etc/cron.d/purge-atop-logs
    - /etc/cron.d/reflector

- name: Mask undesirable services that remain for dependency reasons
  systemd: name={{ item }} state=stopped enabled=no masked=yes
  with_items:
    - lvm2-monitor  # https://www.reddit.com/r/archlinux/comments/azeshi/linux_50_hangs/?st=jt3lfy9i&sh=3f5adfce
    - lvm2-lvmetad
    - upower

- name: Stop old services
  service: name={{ item }} state=stopped enabled=no
  with_items:
    - dhcpcd

- name: Don't blacklist Bluetooth
  kernel_blacklist: name={{ item }} state=absent
  with_items:
    - btusb
    - bluetooth
